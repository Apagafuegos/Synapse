import{j as e,L as f,X as j}from"./index-90817e89.js";import{r as s}from"./vendor-d6de9d8b.js";import{b as v}from"./router-41a8dd64.js";import{P as k}from"./PlusIcon-fa0a24a4.js";function w({title:a,titleId:d,...c},o){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:o,"aria-labelledby":d},c),a?s.createElement("title",{id:d},a):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.348 14.652a3.75 3.75 0 0 1 0-5.304m5.304 0a3.75 3.75 0 0 1 0 5.304m-7.425 2.121a6.75 6.75 0 0 1 0-9.546m9.546 0a6.75 6.75 0 0 1 0 9.546M5.106 18.894c-3.808-3.807-3.808-9.98 0-13.788m13.788 0c3.808 3.807 3.808 9.98 0 13.788M12 12h.008v.008H12V12Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z"}))}const N=s.forwardRef(w),S=N;function C({title:a,titleId:d,...c},o){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:o,"aria-labelledby":d},c),a?s.createElement("title",{id:d},a):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5.25 7.5A2.25 2.25 0 0 1 7.5 5.25h9a2.25 2.25 0 0 1 2.25 2.25v9a2.25 2.25 0 0 1-2.25 2.25h-9a2.25 2.25 0 0 1-2.25-2.25v-9Z"}))}const E=s.forwardRef(C),_=E;function L({projectId:a,onSubmit:d,onCancel:c}){const[o,u]=s.useState("file"),[g,m]=s.useState(""),[n,i]=s.useState({}),x=t=>{t.preventDefault(),d({project_id:a,name:g,source_type:o,config:n,parser_config:{log_format:"text"},buffer_size:100,batch_timeout_seconds:2,restart_on_error:!0})};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-lg w-full",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Create Streaming Source"}),e.jsx("button",{onClick:c,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:e.jsx(j,{className:"h-6 w-6"})})]}),e.jsxs("form",{onSubmit:x,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Source Name *"}),e.jsx("input",{type:"text",required:!0,value:g,onChange:t=>m(t.target.value),placeholder:"e.g., Application Logs",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Source Type *"}),e.jsxs("select",{required:!0,value:o,onChange:t=>{u(t.target.value),i({})},className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"file",children:"File (tail -f)"}),e.jsx("option",{value:"command",children:"Command Output"}),e.jsx("option",{value:"tcp",children:"TCP Listener"}),e.jsx("option",{value:"http",children:"HTTP Endpoint"})]})]}),o==="file"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"File Path *"}),e.jsx("input",{type:"text",required:!0,value:n.path||"",onChange:t=>i({...n,path:t.target.value}),placeholder:"/var/log/app.log",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500"})]}),o==="command"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Command *"}),e.jsx("input",{type:"text",required:!0,value:n.command||"",onChange:t=>i({...n,command:t.target.value}),placeholder:"journalctl -f",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Arguments (comma-separated)"}),e.jsx("input",{type:"text",value:n.args?.join(", ")||"",onChange:t=>i({...n,args:t.target.value.split(",").map(h=>h.trim()).filter(Boolean)}),placeholder:"-u, myapp.service",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500"})]})]}),o==="tcp"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"TCP Port *"}),e.jsx("input",{type:"number",required:!0,value:n.port||"",onChange:t=>i({...n,port:parseInt(t.target.value)}),placeholder:"5140",min:"1",max:"65535",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500"})]}),o==="http"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Endpoint Path *"}),e.jsx("input",{type:"text",required:!0,value:n.path||"",onChange:t=>i({...n,path:t.target.value}),placeholder:"/ingest/logs",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("button",{type:"button",onClick:c,className:"px-4 py-2 text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:!g||Object.keys(n).length===0,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:"Create Source"})]})]})]})})}function $(){const{projectId:a}=v(),[d,c]=s.useState([]),[o,u]=s.useState(null),[g,m]=s.useState(!0),[n,i]=s.useState(!1);s.useEffect(()=>{if(a){x(),t();const r=setInterval(t,5e3);return()=>clearInterval(r)}},[a]);const x=async()=>{try{m(!0);const r=await fetch(`/api/projects/${a}/streaming/sources`);if(!r.ok)throw new Error("Failed to fetch sources");const l=await r.json();c(l)}catch(r){console.error("Error fetching sources:",r)}finally{m(!1)}},t=async()=>{try{const r=await fetch(`/api/projects/${a}/streaming/stats`);if(!r.ok)throw new Error("Failed to fetch stats");const l=await r.json();u(l)}catch(r){console.error("Error fetching stats:",r)}},h=async r=>{try{const l=await fetch(`/api/projects/${a}/streaming/sources`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!l.ok){const y=await l.json();throw new Error(y.error||"Failed to create source")}i(!1),x()}catch(l){console.error("Error creating source:",l),alert(l instanceof Error?l.message:"Failed to create source")}},p=async r=>{if(confirm("Are you sure you want to stop this streaming source?"))try{if(!(await fetch(`/api/projects/${a}/streaming/sources/${r}`,{method:"DELETE"})).ok)throw new Error("Failed to stop source");x()}catch(l){console.error("Error stopping source:",l),alert("Failed to stop source")}},b={active:"bg-green-100 text-green-800 border-green-300",inactive:"bg-gray-100 text-gray-800 border-gray-300",error:"bg-red-100 text-red-800 border-red-300"};return e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(S,{className:"h-8 w-8 text-blue-600"}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Real-Time Log Streaming"})]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Monitor and analyze logs as they arrive in real-time"})]}),e.jsxs("button",{onClick:()=>i(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[e.jsx(k,{className:"h-5 w-5"}),"New Source"]})]}),o&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-2",children:"Active Sources"}),e.jsx("div",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:o.active_sources})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-2",children:"Live Connections"}),e.jsx("div",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:o.active_connections})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-2",children:"Logs Processed"}),e.jsx("div",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:o.total_logs_processed.toLocaleString()})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200 dark:border-gray-700",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Active Sources"})}),g?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(f,{size:"lg"})}):d.length===0?e.jsxs("div",{className:"p-8 text-center text-gray-500 dark:text-gray-400",children:[e.jsx("p",{children:"No streaming sources configured."}),e.jsx("p",{className:"text-sm mt-1",children:"Create one to get started!"})]}):e.jsx("div",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:d.map(r=>e.jsx("div",{className:"p-6 hover:bg-gray-50 dark:hover:bg-gray-700/50",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:r.name}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium border ${b[r.status]}`,children:r.status.toUpperCase()})]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:["Type: ",e.jsx("span",{className:"font-medium",children:r.source_type})]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-500",children:["Created: ",new Date(r.created_at).toLocaleString()]})]}),e.jsxs("button",{onClick:()=>p(r.source_id),className:"flex items-center gap-2 px-3 py-2 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors",children:[e.jsx(_,{className:"h-4 w-4"}),"Stop"]})]})},r.source_id))})]}),n&&a&&e.jsx(L,{projectId:a,onSubmit:h,onCancel:()=>i(!1)})]})}export{$ as default};
