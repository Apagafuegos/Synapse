import{u as le,j as e,L as $}from"./index-90817e89.js";import{r as a}from"./vendor-d6de9d8b.js";import{u as A}from"./useMutation-04fdee44.js";import{u as y,a as d}from"./api-fe1a9747.js";import ie from"./NotFound-d6459cf2.js";import{b as O,c as de}from"./router-41a8dd64.js";import{D as L,X as V,A as ce}from"./XCircleIcon-913e6dd0.js";import{C as Q,a as W}from"./ClockIcon-06516420.js";import{C as me}from"./CheckCircleIcon-27af60e8.js";function xe({title:t,titleId:l,...o},i){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:i,"aria-labelledby":l},o),t?a.createElement("title",{id:l},t):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5m-13.5-9L12 3m0 0 4.5 4.5M12 3v13.5"}))}const ue=a.forwardRef(xe),ge=ue;function he({title:t,titleId:l,...o},i){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:i,"aria-labelledby":l},o),t?a.createElement("title",{id:l},t):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"}))}const pe=a.forwardRef(he),ye=pe,je=()=>{const{data:t,isLoading:l,error:o,refetch:i}=y("settings",d.system.getSettings,{staleTime:3e5,cacheTime:6e5,retry:2,refetchOnWindowFocus:!1});return{settings:t,isLoading:l,error:o,refetch:i,getProvider:()=>t?.default_provider||"openrouter",getLevel:()=>t?.default_level||"ERROR",getMaxLines:()=>t?.max_lines||1e3,hasApiKey:()=>!!t?.api_key?.trim(),isConfigured:()=>!!(t?.default_provider&&t?.api_key?.trim())}};function Fe(){const{projectId:t}=O();console.log("ProjectDetail: URL params from useParams():",{projectId:t,allParams:O()}),console.log("ProjectDetail: Current URL:",window.location.href),console.log("ProjectDetail: Current pathname:",window.location.pathname),console.log("ProjectDetail: Using projectId instead of projectId:",t);const l=de(),[o,i]=a.useState(null),[j,F]=a.useState(!1),[D,f]=a.useState(null),[b,P]=a.useState(new Set),[E,g]=a.useState(null),[I,N]=a.useState(null),[U,_]=a.useState(null),[k,B]=a.useState(""),[M,R]=a.useState(300),w=le(),{settings:fe,isLoading:v,getProvider:c,getLevel:q,isConfigured:m}=je(),{data:h,isLoading:H,error:z}=y(["project",t],()=>t?(console.log("ProjectDetail: Fetching project with ID:",t),d.projects.getById(t)):Promise.reject("No project ID"),{enabled:!!t,retry:!1,onError:r=>{console.error("ProjectDetail: Failed to fetch project:",r),console.error("ProjectDetail: Project ID was:",t)}}),{data:p,isLoading:K,error:C,refetch:X}=y(["project-files",t],()=>t?d.files.getByProject(t):Promise.resolve([]),{enabled:!!t&&!!h}),{data:x,isLoading:G,error:S}=y(["project-analyses",t],()=>t?d.analysis.getByProject(t):Promise.resolve({analyses:[],pagination:{page:1,per_page:20,total:0}}),{enabled:!!t&&!!h,refetchInterval:r=>r?.analyses?.some(n=>n.status==="running"||n.status==="pending")?3e3:!1}),J=A(r=>t?d.files.upload(t,r):Promise.reject("No project ID"),{onSuccess:()=>{t&&w.invalidateQueries(["project-files",t]),i(null),f(null)},onError:r=>{f(r.message||"Failed to upload file")}}),Y=A(({fileId:r,options:s})=>t?d.analysis.create(t,r,{provider:c(),level:q(),user_context:s?.userContext,timeout_seconds:s?.timeoutSeconds}):Promise.reject("No project ID"),{onSuccess:()=>{t&&w.invalidateQueries(["project-analyses",t]),g(null),B(""),R(300),_(null)},onError:r=>{g(r.message||"Failed to start analysis")}}),Z=A(r=>t?d.files.delete(t,r):Promise.reject("No project ID"),{onSuccess:()=>{t&&w.invalidateQueries(["project-files",t])},onError:r=>{console.error("Failed to delete file:",r)}}),ee=r=>{const s=r.target.files?.[0];s&&(i(s),f(null))},re=async()=>{if(!(!o||!t)){F(!0);try{await J.mutateAsync(o)}catch{}finally{F(!1)}}},te=async(r,s)=>{if(!m()){g(`Analysis requires configuration. Please go to Settings and configure your AI provider (${c()}) and API key.`);return}P(n=>new Set(n).add(r)),g(null);try{await Y.mutateAsync({fileId:r,options:s})}catch{}finally{P(n=>{const u=new Set(n);return u.delete(r),u})}},se=async r=>{if(window.confirm("Are you sure you want to delete this file?")){N(null);try{await Z.mutateAsync(r)}catch(s){console.error("Failed to delete file:",s);const n=s instanceof Error?s.message:"Failed to delete file";N(n)}}},T=r=>{if(!r||r===0)return"0 Bytes";const s=1024,n=["Bytes","KB","MB","GB"],u=Math.floor(Math.log(r)/Math.log(s));return parseFloat((r/Math.pow(s,u)).toFixed(2))+" "+n[u]},ae=r=>{switch(r){case"completed":return e.jsx(me,{className:"h-5 w-5 text-green-500"});case"failed":return e.jsx(V,{className:"h-5 w-5 text-red-500"});case"running":return e.jsx(W,{className:"h-5 w-5 text-blue-500 animate-spin"});default:return e.jsx(W,{className:"h-5 w-5 text-gray-500"})}},oe=r=>{switch(r){case"completed":return"Completed";case"failed":return"Failed";case"running":return"Running";case"pending":return"Pending";default:return r}},ne=r=>{l(`/analysis/${r}`)};return H?e.jsx("div",{className:"flex items-center justify-center min-h-96",children:e.jsx($,{size:"lg"})}):z||!h?(console.log("ProjectDetail: Showing NotFound component"),console.log("ProjectDetail: projectError:",z),console.log("ProjectDetail: project:",h),console.log("ProjectDetail: projectId:",t),e.jsx(ie,{})):K||G?e.jsx("div",{className:"flex items-center justify-center min-h-96",children:e.jsx($,{size:"lg"})}):e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Project Details"}),e.jsx("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:"Upload log files and start analysis for your project."})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 shadow rounded-lg p-6 mb-8",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"Upload Log Files"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ge,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("label",{htmlFor:"file-upload",className:"cursor-pointer",children:[e.jsx("span",{className:"mt-2 block text-sm font-medium text-gray-900 dark:text-gray-300",children:"Choose a log file"}),e.jsx("span",{className:"mt-1 block text-xs text-gray-500 dark:text-gray-400",children:"Supported formats: .log, .txt"})]}),e.jsx("input",{id:"file-upload",name:"file-upload",type:"file",className:"sr-only",accept:".log,.txt",onChange:ee,disabled:j})]})]})}),o&&e.jsx("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(L,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:o.name}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:T(o.size)})]})]}),e.jsx("button",{type:"button",onClick:()=>i(null),className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:e.jsx(V,{className:"h-5 w-5"})})]})}),D&&e.jsx("div",{className:"bg-error-50 dark:bg-error-900/20 border border-error-200 dark:border-error-800 rounded-md p-3",children:e.jsx("p",{className:"text-sm text-error-700 dark:text-error-300",children:D})}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"button",onClick:re,disabled:!o||j,className:"btn-primary",children:j?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Uploading..."]}):"Upload File"})})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 shadow rounded-lg p-6 mb-8",children:[e.jsxs("h2",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:["Log Files (",p?.length||0,")"]}),C?e.jsxs("div",{className:"bg-error-50 dark:bg-error-900/20 border border-error-200 dark:border-error-800 rounded-md p-4",children:[e.jsx("p",{className:"text-sm text-error-700 dark:text-error-300",children:C instanceof Error?C.message:"Failed to load files"}),e.jsx("button",{type:"button",onClick:()=>X(),className:"mt-2 text-sm font-medium text-error-800 dark:text-error-200 hover:text-error-900 dark:hover:text-error-100",children:"Try again"})]}):p&&p.length>0?e.jsx("div",{className:"space-y-4",children:p.map(r=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(L,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:r.filename}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[T(r.file_size)," • ",r.line_count?.toLocaleString()||"0"," lines",e.jsx("br",{}),"Uploaded ",new Date(r.created_at).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{type:"button",onClick:()=>_(U===r.id?null:r.id),disabled:b.has(r.id)||v||!m(),className:"btn-secondary",title:m()?"Analysis options":`Configure ${c()} provider in Settings`,children:[e.jsx("svg",{className:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"})}),"Options"]}),e.jsxs("button",{type:"button",onClick:()=>te(r.id,{userContext:k||void 0,timeoutSeconds:M}),disabled:b.has(r.id)||v||!m(),className:"btn-primary",title:m()?`Analyze with ${c()}`:`Configure ${c()} provider in Settings`,children:[e.jsx(Q,{className:"h-4 w-4 mr-1"}),b.has(r.id)?"Analyzing...":v?"Loading...":`Analyze (${c()})`]}),e.jsxs("button",{type:"button",onClick:()=>se(r.id),className:"btn-secondary",children:[e.jsx(ye,{className:"h-4 w-4 mr-1"}),"Delete"]})]})]}),U===r.id&&e.jsxs("div",{className:"mt-4 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg space-y-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Analysis Options"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1",children:"User Context (optional)"}),e.jsx("textarea",{className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-800 dark:text-white text-sm",placeholder:"Provide additional context for analysis (max 2000 characters)...",value:k,onChange:s=>B(s.target.value.slice(0,2e3)),rows:3}),e.jsxs("div",{className:"flex justify-between mt-1",children:[e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Add context about your application, environment, or specific concerns"}),e.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:[k.length,"/2000"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Timeout (seconds)"}),e.jsx("input",{type:"number",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-800 dark:text-white text-sm",min:"60",max:"1800",value:M,onChange:s=>R(parseInt(s.target.value)||300)}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Set custom timeout (60-1800 seconds)"})]})]})]},r.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(L,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900 dark:text-white",children:"No log files yet"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:"Upload a log file to get started with analysis."})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 shadow rounded-lg p-6",children:[e.jsxs("h2",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:["Recent Analyses (",x?.analyses?.length||0,")"]}),S?e.jsx("div",{className:"bg-error-50 dark:bg-error-900/20 border border-error-200 dark:border-error-800 rounded-md p-4",children:e.jsx("p",{className:"text-sm text-error-700 dark:text-error-300",children:S instanceof Error?S.message:"Failed to load analyses"})}):x&&x.analyses&&x.analyses.length>0?e.jsx("div",{className:"space-y-4",children:x.analyses.map(r=>e.jsx("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4 cursor-pointer hover:border-blue-300 dark:hover:border-blue-600 transition-colors",onClick:()=>ne(r.id),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[ae(r.status),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:[r.ai_provider," Analysis"]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[r.ai_provider," • Started ",new Date(r.created_at).toLocaleDateString(),r.updated_at&&e.jsxs("span",{children:[" • Updated ",new Date(r.updated_at).toLocaleDateString()]})]}),r.error&&e.jsxs("p",{className:"text-xs text-error-600 dark:text-error-400 mt-1",children:["Error: ",r.error]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${r.status==="completed"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":r.status==="failed"?"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200":r.status==="running"?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200":"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200"}`,children:oe(r.status)}),e.jsx(ce,{className:"h-4 w-4 text-gray-400"})]})]})},r.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Q,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900 dark:text-white",children:"No analyses yet"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:'Upload a log file and click "Analyze" to start your first analysis.'})]})]}),E&&e.jsx("div",{className:"fixed bottom-4 right-4 bg-error-50 dark:bg-error-900/20 border border-error-200 dark:border-error-800 rounded-md p-4 max-w-md",children:e.jsxs("p",{className:"text-sm text-error-700 dark:text-error-300",children:["Analysis Error: ",E]})}),I&&e.jsx("div",{className:"fixed bottom-16 right-4 bg-error-50 dark:bg-error-900/20 border border-error-200 dark:border-error-800 rounded-md p-4 max-w-md",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("p",{className:"text-sm text-error-700 dark:text-error-300",children:["Delete Error: ",I]}),e.jsx("button",{type:"button",onClick:()=>N(null),className:"ml-2 text-error-400 hover:text-error-600",children:"×"})]})})]})}export{Fe as default};
