import{_ as J,b as F,d as H,i as j,e as x,t as K,f as W,r as L,h as _,s as q,k as V,n as O,S as z,u as G,l as X}from"./index-d3d76560.js";import{c as b}from"./vendor-d6de9d8b.js";var Y=function(r){J(a,r);function a(n,s){var e;return e=r.call(this)||this,e.client=n,e.options=s,e.trackedProps=[],e.selectError=null,e.bindMethods(),e.setOptions(s),e}var t=a.prototype;return t.bindMethods=function(){this.remove=this.remove.bind(this),this.refetch=this.refetch.bind(this)},t.onSubscribe=function(){this.listeners.length===1&&(this.currentQuery.addObserver(this),k(this.currentQuery,this.options)&&this.executeFetch(),this.updateTimers())},t.onUnsubscribe=function(){this.listeners.length||this.destroy()},t.shouldFetchOnReconnect=function(){return I(this.currentQuery,this.options,this.options.refetchOnReconnect)},t.shouldFetchOnWindowFocus=function(){return I(this.currentQuery,this.options,this.options.refetchOnWindowFocus)},t.destroy=function(){this.listeners=[],this.clearTimers(),this.currentQuery.removeObserver(this)},t.setOptions=function(s,e){var u=this.options,i=this.currentQuery;if(this.options=this.client.defaultQueryObserverOptions(s),typeof this.options.enabled<"u"&&typeof this.options.enabled!="boolean")throw new Error("Expected enabled to be a boolean");this.options.queryKey||(this.options.queryKey=u.queryKey),this.updateQuery();var c=this.hasListeners();c&&B(this.currentQuery,i,this.options,u)&&this.executeFetch(),this.updateResult(e),c&&(this.currentQuery!==i||this.options.enabled!==u.enabled||this.options.staleTime!==u.staleTime)&&this.updateStaleTimeout();var o=this.computeRefetchInterval();c&&(this.currentQuery!==i||this.options.enabled!==u.enabled||o!==this.currentRefetchInterval)&&this.updateRefetchInterval(o)},t.getOptimisticResult=function(s){var e=this.client.defaultQueryObserverOptions(s),u=this.client.getQueryCache().build(this.client,e);return this.createResult(u,e)},t.getCurrentResult=function(){return this.currentResult},t.trackResult=function(s,e){var u=this,i={},c=function(d){u.trackedProps.includes(d)||u.trackedProps.push(d)};return Object.keys(s).forEach(function(o){Object.defineProperty(i,o,{configurable:!1,enumerable:!0,get:function(){return c(o),s[o]}})}),(e.useErrorBoundary||e.suspense)&&c("error"),i},t.getNextResult=function(s){var e=this;return new Promise(function(u,i){var c=e.subscribe(function(o){o.isFetching||(c(),o.isError&&s?.throwOnError?i(o.error):u(o))})})},t.getCurrentQuery=function(){return this.currentQuery},t.remove=function(){this.client.getQueryCache().remove(this.currentQuery)},t.refetch=function(s){return this.fetch(F({},s,{meta:{refetchPage:s?.refetchPage}}))},t.fetchOptimistic=function(s){var e=this,u=this.client.defaultQueryObserverOptions(s),i=this.client.getQueryCache().build(this.client,u);return i.fetch().then(function(){return e.createResult(i,u)})},t.fetch=function(s){var e=this;return this.executeFetch(s).then(function(){return e.updateResult(),e.currentResult})},t.executeFetch=function(s){this.updateQuery();var e=this.currentQuery.fetch(this.options,s);return s?.throwOnError||(e=e.catch(H)),e},t.updateStaleTimeout=function(){var s=this;if(this.clearStaleTimeout(),!(j||this.currentResult.isStale||!x(this.options.staleTime))){var e=K(this.currentResult.dataUpdatedAt,this.options.staleTime),u=e+1;this.staleTimeoutId=setTimeout(function(){s.currentResult.isStale||s.updateResult()},u)}},t.computeRefetchInterval=function(){var s;return typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.currentResult.data,this.currentQuery):(s=this.options.refetchInterval)!=null?s:!1},t.updateRefetchInterval=function(s){var e=this;this.clearRefetchInterval(),this.currentRefetchInterval=s,!(j||this.options.enabled===!1||!x(this.currentRefetchInterval)||this.currentRefetchInterval===0)&&(this.refetchIntervalId=setInterval(function(){(e.options.refetchIntervalInBackground||W.isFocused())&&e.executeFetch()},this.currentRefetchInterval))},t.updateTimers=function(){this.updateStaleTimeout(),this.updateRefetchInterval(this.computeRefetchInterval())},t.clearTimers=function(){this.clearStaleTimeout(),this.clearRefetchInterval()},t.clearStaleTimeout=function(){this.staleTimeoutId&&(clearTimeout(this.staleTimeoutId),this.staleTimeoutId=void 0)},t.clearRefetchInterval=function(){this.refetchIntervalId&&(clearInterval(this.refetchIntervalId),this.refetchIntervalId=void 0)},t.createResult=function(s,e){var u=this.currentQuery,i=this.options,c=this.currentResult,o=this.currentResultState,d=this.currentResultOptions,p=s!==u,y=p?s.state:this.currentQueryInitialState,m=p?this.currentResult:this.previousQueryResult,h=s.state,g=h.dataUpdatedAt,C=h.error,$=h.errorUpdatedAt,Q=h.isFetching,f=h.status,A=!1,U=!1,v;if(e.optimisticResults){var w=this.hasListeners(),M=!w&&k(s,e),N=w&&B(s,u,e,i);(M||N)&&(Q=!0,g||(f="loading"))}if(e.keepPreviousData&&!h.dataUpdateCount&&m?.isSuccess&&f!=="error")v=m.data,g=m.dataUpdatedAt,f=m.status,A=!0;else if(e.select&&typeof h.data<"u")if(c&&h.data===o?.data&&e.select===this.selectFn)v=this.selectResult;else try{this.selectFn=e.select,v=e.select(h.data),e.structuralSharing!==!1&&(v=L(c?.data,v)),this.selectResult=v,this.selectError=null}catch(S){_().error(S),this.selectError=S}else v=h.data;if(typeof e.placeholderData<"u"&&typeof v>"u"&&(f==="loading"||f==="idle")){var R;if(c?.isPlaceholderData&&e.placeholderData===d?.placeholderData)R=c.data;else if(R=typeof e.placeholderData=="function"?e.placeholderData():e.placeholderData,e.select&&typeof R<"u")try{R=e.select(R),e.structuralSharing!==!1&&(R=L(c?.data,R)),this.selectError=null}catch(S){_().error(S),this.selectError=S}typeof R<"u"&&(f="success",v=R,U=!0)}this.selectError&&(C=this.selectError,v=this.selectResult,$=Date.now(),f="error");var D={status:f,isLoading:f==="loading",isSuccess:f==="success",isError:f==="error",isIdle:f==="idle",data:v,dataUpdatedAt:g,error:C,errorUpdatedAt:$,failureCount:h.fetchFailureCount,errorUpdateCount:h.errorUpdateCount,isFetched:h.dataUpdateCount>0||h.errorUpdateCount>0,isFetchedAfterMount:h.dataUpdateCount>y.dataUpdateCount||h.errorUpdateCount>y.errorUpdateCount,isFetching:Q,isRefetching:Q&&f!=="loading",isLoadingError:f==="error"&&h.dataUpdatedAt===0,isPlaceholderData:U,isPreviousData:A,isRefetchError:f==="error"&&h.dataUpdatedAt!==0,isStale:P(s,e),refetch:this.refetch,remove:this.remove};return D},t.shouldNotifyListeners=function(s,e){if(!e)return!0;var u=this.options,i=u.notifyOnChangeProps,c=u.notifyOnChangePropsExclusions;if(!i&&!c||i==="tracked"&&!this.trackedProps.length)return!0;var o=i==="tracked"?this.trackedProps:i;return Object.keys(s).some(function(d){var p=d,y=s[p]!==e[p],m=o?.some(function(g){return g===d}),h=c?.some(function(g){return g===d});return y&&!h&&(!o||m)})},t.updateResult=function(s){var e=this.currentResult;if(this.currentResult=this.createResult(this.currentQuery,this.options),this.currentResultState=this.currentQuery.state,this.currentResultOptions=this.options,!q(this.currentResult,e)){var u={cache:!0};s?.listeners!==!1&&this.shouldNotifyListeners(this.currentResult,e)&&(u.listeners=!0),this.notify(F({},u,s))}},t.updateQuery=function(){var s=this.client.getQueryCache().build(this.client,this.options);if(s!==this.currentQuery){var e=this.currentQuery;this.currentQuery=s,this.currentQueryInitialState=s.state,this.previousQueryResult=this.currentResult,this.hasListeners()&&(e?.removeObserver(this),s.addObserver(this))}},t.onQueryUpdate=function(s){var e={};s.type==="success"?e.onSuccess=!0:s.type==="error"&&!V(s.error)&&(e.onError=!0),this.updateResult(e),this.hasListeners()&&this.updateTimers()},t.notify=function(s){var e=this;O.batch(function(){s.onSuccess?(e.options.onSuccess==null||e.options.onSuccess(e.currentResult.data),e.options.onSettled==null||e.options.onSettled(e.currentResult.data,null)):s.onError&&(e.options.onError==null||e.options.onError(e.currentResult.error),e.options.onSettled==null||e.options.onSettled(void 0,e.currentResult.error)),s.listeners&&e.listeners.forEach(function(u){u(e.currentResult)}),s.cache&&e.client.getQueryCache().notify({query:e.currentQuery,type:"observerResultsUpdated"})})},a}(z);function Z(r,a){return a.enabled!==!1&&!r.state.dataUpdatedAt&&!(r.state.status==="error"&&a.retryOnMount===!1)}function k(r,a){return Z(r,a)||r.state.dataUpdatedAt>0&&I(r,a,a.refetchOnMount)}function I(r,a,t){if(a.enabled!==!1){var n=typeof t=="function"?t(r):t;return n==="always"||n!==!1&&P(r,a)}return!1}function B(r,a,t,n){return t.enabled!==!1&&(r!==a||n.enabled===!1)&&(!t.suspense||r.state.status!=="error")&&P(r,t)}function P(r,a){return r.isStaleByTime(a.staleTime)}function ee(){var r=!1;return{clearReset:function(){r=!1},reset:function(){r=!0},isReset:function(){return r}}}var te=b.createContext(ee()),re=function(){return b.useContext(te)};function se(r,a,t){return typeof a=="function"?a.apply(void 0,t):typeof a=="boolean"?a:!!r}function ne(r,a){var t=b.useRef(!1),n=b.useState(0),s=n[1],e=G(),u=re(),i=e.defaultQueryObserverOptions(r);i.optimisticResults=!0,i.onError&&(i.onError=O.batchCalls(i.onError)),i.onSuccess&&(i.onSuccess=O.batchCalls(i.onSuccess)),i.onSettled&&(i.onSettled=O.batchCalls(i.onSettled)),i.suspense&&(typeof i.staleTime!="number"&&(i.staleTime=1e3),i.cacheTime===0&&(i.cacheTime=1)),(i.suspense||i.useErrorBoundary)&&(u.isReset()||(i.retryOnMount=!1));var c=b.useState(function(){return new a(e,i)}),o=c[0],d=o.getOptimisticResult(i);if(b.useEffect(function(){t.current=!0,u.clearReset();var p=o.subscribe(O.batchCalls(function(){t.current&&s(function(y){return y+1})}));return o.updateResult(),function(){t.current=!1,p()}},[u,o]),b.useEffect(function(){o.setOptions(i,{listeners:!1})},[i,o]),i.suspense&&d.isLoading)throw o.fetchOptimistic(i).then(function(p){var y=p.data;i.onSuccess==null||i.onSuccess(y),i.onSettled==null||i.onSettled(y,null)}).catch(function(p){u.clearReset(),i.onError==null||i.onError(p),i.onSettled==null||i.onSettled(void 0,p)});if(d.isError&&!u.isReset()&&!d.isFetching&&se(i.suspense,i.useErrorBoundary,[d.error,o.getCurrentQuery()]))throw d.error;return i.notifyOnChangeProps==="tracked"&&(d=o.trackResult(d,i)),d}function de(r,a,t){var n=X(r,a,t);return ne(n,Y)}const E="/api";console.log("API Service: API_BASE is set to:",E);class T extends Error{constructor(a,t,n){super(a),this.status=t,this.code=n,this.name="ApiError"}}async function l(r,a={}){console.log(`API Request: ${E}${r}`,a);const t=await fetch(`${E}${r}`,{headers:{"Content-Type":"application/json",...a.headers},...a});if(console.log(`API Response: ${t.status} ${t.statusText}`),!t.ok){let n=`HTTP ${t.status}`,s;try{const e=await t.json();n=e.message||e.error||n,s=e.code,console.error("API Error:",e)}catch{n=t.statusText||n}throw new T(n,t.status,s)}if(!(t.status===204||t.headers.get("content-length")==="0"))try{const n=await t.json();return console.log("API Success Response:",n),n}catch{throw new T("Invalid JSON response",t.status)}}const ie={async getAll(){return l("/projects")},async getById(r){return l(`/projects/${r}`)},async create(r){return l("/projects",{method:"POST",body:JSON.stringify(r)})},async delete(r){return l(`/projects/${r}`,{method:"DELETE"})},async update(r,a){return l(`/projects/${r}`,{method:"PATCH",body:JSON.stringify(a)})}},ae={async getByProject(r){return l(`/projects/${r}/files`)},async upload(r,a){const t=new FormData;return t.append("file",a),l(`/projects/${r}/files`,{method:"POST",headers:{},body:t})},async delete(r,a){return l(`/projects/${r}/files/${a}`,{method:"DELETE"})},async getContent(r,a,t){const n=new URLSearchParams;t&&n.append("lines",t.toString());const s=`/projects/${r}/files/${a}/content${n.toString()?`?${n}`:""}`;return l(s)}},ue={async create(r,a,t){return l(`/projects/${r}/files/${a}/analyze`,{method:"POST",body:JSON.stringify(t)})},async getById(r){return l(`/analyses/${r}`)},async getByProject(r,a=1,t=20){const n=new URLSearchParams({page:a.toString(),per_page:t.toString()});return l(`/projects/${r}/analyses?${n}`)},async cancel(r){return l(`/analyses/${r}/cancel`,{method:"POST"})},async delete(r){return l(`/analyses/${r}`,{method:"DELETE"})},async export(r,a,t="json"){const n=await fetch(`${E}/projects/${a}/analyses/${r}/export/${t}`,{method:"GET"});if(!n.ok)throw new T(`Export failed: HTTP ${n.status}`,n.status);return n.blob()}},oe={async getStats(){return l("/dashboard/stats")}},ce={async getHealth(){return l("/health")},async getSettings(){return l("/settings")},async updateSettings(r){return l("/settings",{method:"PATCH",body:JSON.stringify(r)})},async fetchModels(r,a,t=!1){return l("/models/available",{method:"POST",body:JSON.stringify({provider:r,api_key:a,force_refresh:t})})}},fe={projects:ie,files:ae,analysis:ue,dashboard:oe,system:ce,post:(r,a)=>l(r,{method:"POST",body:a?JSON.stringify(a):void 0}),get:r=>l(r)};export{fe as a,ue as b,se as s,de as u};
